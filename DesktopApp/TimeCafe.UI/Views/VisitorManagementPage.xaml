<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="TimeCafe.UI.Views.VisitorManagementPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behaviors="using:TimeCafe.UI.Behaviors"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:customControls="using:TimeCafe.UI.Styles.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:local="using:TimeCafe.UI.Views"
    xmlns:localModels="using:TimeCafe.UI.Models"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:TimeCafe.Core.Models"
    xmlns:pagination="using:TimeCafe.UI.Controls"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:vm="using:TimeCafe.UI.ViewModels"
    x:Name="VisitorPage"
    mc:Ignorable="d">

    <Page.Resources>
        <Style TargetType="TextBox">
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="IsSpellCheckEnabled" Value="True" />
            <Setter Property="AcceptsReturn" Value="False" />
            <Setter Property="SelectionHighlightColor" Value="Green" />
            <Setter Property="CornerRadius" Value="{StaticResource ControlCornerRadius}" />
        </Style>
    </Page.Resources>

    <Grid x:Name="ContentArea">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <Grid Grid.Row="0" Padding="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <TextBlock
                    FontSize="24"
                    FontWeight="Bold"
                    Text="Управление посетителями" />
                <TextBlock FontSize="16" Text="Активные посетители в заведении" />
            </StackPanel>

            <StackPanel
                Grid.Column="1"
                Orientation="Horizontal"
                Spacing="10">
                <TextBlock
                    VerticalAlignment="Center"
                    FontSize="18"
                    FontWeight="Bold"
                    Text="Всего посетителей:" />
                <TextBlock
                    VerticalAlignment="Center"
                    FontSize="18"
                    FontWeight="Bold"
                    Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                    Text="{Binding TotalVisitors}" />
            </StackPanel>
        </Grid>

        <!--  Visitors List  -->
        <Grid Grid.Row="1" Padding="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!--  Search and Filters  -->
            <Grid Grid.Row="0" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>

                <TextBox
                    Grid.Column="0"
                    Width="300"
                    HorizontalAlignment="Left"
                    Header="Поиск по имени:"
                    PlaceholderText="Введите имя или фамилию"
                    Text="{Binding SearchText, Mode=TwoWay}" />

                <ComboBox
                    Grid.Column="1"
                    Width="200"
                    DisplayMemberPath="TariffName"
                    Header="Фильтр по тарифу:"
                    ItemsSource="{Binding AvailableTariffs}"
                    PlaceholderText="Все тарифы"
                    SelectedItem="{Binding SelectedTariffFilter, Mode=TwoWay}" />
            </Grid>

            <!--  Visitors ListView  -->
            <ListView
                Grid.Row="1"
                ItemsSource="{Binding FilteredVisitors}"
                SelectionMode="None">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:Visit">
                        <Grid Margin="0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>

                            <!--  Avatar  -->
                            <Grid
                                Grid.Column="0"
                                Width="50"
                                Height="50"
                                Margin="0,0,16,0"
                                Background="{ThemeResource AccentFillColorDefaultBrush}"
                                CornerRadius="25">
                                <FontIcon
                                    FontSize="24"
                                    Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                    Glyph="&#xE779;" />
                            </Grid>

                            <!--  Client Info  -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock
                                    FontSize="16"
                                    FontWeight="Bold"
                                    Text="{Binding Client.FirstName}" />
                                <TextBlock FontSize="14" Text="{Binding Client.LastName}" />
                                <TextBlock
                                    FontSize="12"
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    Text="{Binding Client.PhoneNumber}" />
                            </StackPanel>

                            <!--  Time Info  -->
                            <StackPanel
                                Grid.Column="2"
                                Margin="16,0"
                                VerticalAlignment="Center">
                                <TextBlock
                                    FontSize="14"
                                    FontWeight="Bold"
                                    Text="Время входа:" />
                                <TextBlock FontSize="12" Text="{Binding EntryTime}" />
                                <TextBlock
                                    FontSize="14"
                                    FontWeight="Bold"
                                    Text="Пребывание:" />
                                <TextBlock
                                    FontSize="12"
                                    Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                    Text="{Binding DurationText}" />
                            </StackPanel>

                            <!--  Tariff Info  -->
                            <StackPanel
                                Grid.Column="3"
                                Margin="16,0"
                                VerticalAlignment="Center">
                                <TextBlock
                                    FontSize="14"
                                    FontWeight="Bold"
                                    Text="Тариф:" />
                                <TextBlock FontSize="12" Text="{Binding Tariff.TariffName}" />
                                <TextBlock
                                    FontSize="14"
                                    FontWeight="Bold"
                                    Text="Стоимость:" />
                                <TextBlock
                                    FontSize="12"
                                    Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"
                                    Text="{Binding CurrentCost, Converter={StaticResource PriceConverter}, ConverterParameter=3}" />
                            </StackPanel>

                            <!--  Exit Button  -->
                            <Button
                                Grid.Column="4"
                                Margin="16,0,0,0"
                                Click="ExitButton_Click"
                                Tag="{Binding}"
                                Content="Выход"
                                Style="{StaticResource AccentButtonStyle}" />
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <!--  Empty State  -->
            <Grid
                Grid.Row="1"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Visibility="{Binding HasVisitors, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <FontIcon
                        FontSize="120"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        Glyph="&#xE779;" />
                    <TextBlock
                        Margin="0,16,0,0"
                        HorizontalAlignment="Center"
                        FontSize="18"
                        FontWeight="Bold"
                        Text="Нет активных посетителей" />
                    <TextBlock
                        Margin="0,8,0,0"
                        HorizontalAlignment="Center"
                        FontSize="14"
                        Text="В данный момент в заведении нет посетителей" />
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</Page> 