<Page
    x:Class="TimeCafeWinUI3.Views.CreateClientPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behaviors="using:TimeCafeWinUI3.Behaviors"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:customControls="using:TimeCafeWinUI3.Styles.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helpers="using:TimeCafeWinUI3.Helpers"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:local="using:TimeCafeWinUI3.Views"
    xmlns:localModels="using:TimeCafeWinUI3.Models"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:TimeCafeWinUI3.Core.Models"
    xmlns:pagination="using:TimeCafeWinUI3.Controls"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:vm="using:TimeCafeWinUI3.ViewModels"
    xmlns:converters="using:TimeCafeWinUI3.Converters"
    mc:Ignorable="d">

    <Page.Resources>
        <Style TargetType="TextBox">
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="IsSpellCheckEnabled" Value="True" />
            <Setter Property="AcceptsReturn" Value="False" />
            <Setter Property="SelectionHighlightColor" Value="Green" />
            <!--  убрать и заменит, на accentcolor  -->
            <Setter Property="CornerRadius" Value="{StaticResource ControlCornerRadius}" />
        </Style>

        <converters:DateOnlyConverter x:Key="DateOnlyConverter" />

        <DataTemplate x:Key="ImageTemplate" x:DataType="models:Client">
            <Grid CornerRadius="{StaticResource ControlCornerRadius}">
                <ToolTipService.ToolTip>
                    <Binding Converter="{StaticResource TooltipConverter}" />
                </ToolTipService.ToolTip>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="auto" />
                </Grid.RowDefinitions>

                <Grid Grid.Row="0" Style="{Binding StatusId, Converter={StaticResource StatusColorConverter}, ConverterParameter=Background}">
                    <FontIcon Glyph="&#xE716; " Style="{Binding StatusId, Converter={StaticResource StatusColorConverter}}" />
                </Grid>

                <StackPanel Grid.Row="1" Padding="{StaticResource ButtonPadding}">

                    <TextBlock
                        Style="{StaticResource BaseTextBlockStyle}"
                        TextTrimming="CharacterEllipsis"
                        TextWrapping="NoWrap">
                        <TextBlock.Text>
                            <Binding>
                                <Binding.Converter>
                                    <helpers:FullNameInitialsConverters />
                                </Binding.Converter>
                            </Binding>
                        </TextBlock.Text>
                    </TextBlock>
                    <TextBlock
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Text="{Binding PhoneNumber}"
                        TextTrimming="CharacterEllipsis"
                        TextWrapping="NoWrap" />
                    <TextBlock
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Text="{Binding Status.StatusName}"
                        TextTrimming="CharacterEllipsis"
                        TextWrapping="NoWrap" />
                </StackPanel>
            </Grid>
        </DataTemplate>
    </Page.Resources>

    <Grid
        x:Name="ContentArea"
        HorizontalAlignment="Stretch"
        ColumnSpacing="16"
        RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="DynamicColumn1" Width="*" />
            <ColumnDefinition x:Name="DynamicColumn2" Width="*" />
        </Grid.ColumnDefinitions>

        <!--  Часть с вводом  -->
        <Grid
            x:Name="FormPanel"
            Grid.Row="0"
            Grid.Column="0"
            RowSpacing="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!--  Подсказки  -->
            <StackPanel
                Grid.Row="0"
                Orientation="Horizontal"
                Spacing="8">
                <TextBlock
                    VerticalAlignment="Bottom"
                    FontSize="24"
                    FontWeight="Bold"
                    Text="Ввод клиента" />
                <Button
                    Padding="{StaticResource IconInfoBadgeIconMargin}"
                    VerticalAlignment="Bottom"
                    Background="Transparent"
                    BorderThickness="0">
                    <Button.Content>
                        <Grid VerticalAlignment="Center">
                            <FontIcon
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                FontSize="16"
                                Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                Glyph="&#xF13F;" />
                            <FontIcon
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                FontSize="16"
                                Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                Glyph="&#xF138;" />
                        </Grid>
                    </Button.Content>

                    <Button.Flyout>
                        <Flyout AreOpenCloseAnimationsEnabled="True">
                            <FlipView
                                Width="400"
                                MaxHeight="400"
                                Margin="0"
                                Background="Transparent"
                                CanBeScrollAnchor="False"
                                ItemsSource="{x:Bind TooltipItems, Mode=OneWay}">
                                <FlipView.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </FlipView.ItemsPanel>
                                <FlipView.ItemTemplate>
                                    <DataTemplate x:DataType="localModels:TooltipItem">
                                        <ScrollViewer VerticalScrollBarVisibility="Auto" VerticalScrollMode="Enabled">
                                            <StackPanel Margin="8">
                                                <TextBlock
                                                    Margin="0,0,0,8"
                                                    FontSize="20"
                                                    FontWeight="Bold"
                                                    Text="{x:Bind Title}" />
                                                <TextBlock
                                                    Margin="0,0,0,12"
                                                    FontSize="14"
                                                    Text="{x:Bind Description}"
                                                    TextWrapping="Wrap" />
                                                <Grid Height="200">
                                                    <MediaPlayerElement
                                                        Margin="0"
                                                        AreTransportControlsEnabled="False"
                                                        AutoPlay="False"
                                                        Source="{Binding MediaSource}" />
                                                </Grid>
                                            </StackPanel>
                                        </ScrollViewer>
                                    </DataTemplate>
                                </FlipView.ItemTemplate>
                            </FlipView>

                        </Flyout>
                    </Button.Flyout>
                </Button>
            </StackPanel>

            <!--  Элементы ввода  -->
            <StackPanel Grid.Row="1" Spacing="12">
                <TextBox
                    Header="Введите имя:"
                    PlaceholderText="Имя"
                    Text="{Binding FirstName, Mode=TwoWay}"
                    ToolTipService.ToolTip="{Binding Header, RelativeSource={RelativeSource Mode=Self}}" />
                <TextBox
                    Header="Введите фамилию:"
                    PlaceholderText="Фамилия"
                    Text="{Binding LastName, Mode=TwoWay}"
                    ToolTipService.ToolTip="{Binding Header, RelativeSource={RelativeSource Mode=Self}}" />
                <TextBox
                    Header="Введите отчество:"
                    PlaceholderText="Отчество"
                    Text="{Binding MiddleName, Mode=TwoWay}"
                    ToolTipService.ToolTip="{Binding Header, RelativeSource={RelativeSource Mode=Self}}" />
                <ComboBox
                    HorizontalAlignment="Stretch"
                    DisplayMemberPath="GenderName"
                    Header="Выберите пол:"
                    ItemsSource="{Binding Genders}"
                    PlaceholderText="Укажите пол"
                    SelectedValue="{Binding GenderId, Mode=TwoWay}"
                    SelectedValuePath="GenderId"
                    ToolTipService.ToolTip="{Binding Header, RelativeSource={RelativeSource Mode=Self}}" />
                <TextBox
                    Header="Введите электронную почту:"
                    PlaceholderText="Электронная почта"
                    Text="{Binding Email, Mode=TwoWay}"
                    ToolTipService.ToolTip="{Binding Header, RelativeSource={RelativeSource Mode=Self}}" />
                <DatePicker
                    HorizontalAlignment="Stretch"
                    Date="{Binding BirthDate, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource DateOnlyConverter}}"
                    DayFormat="{}{dayofweek.solo.full}"
                    Header="Выберите дату рождения:"
                    ToolTipService.ToolTip="{Binding Header, RelativeSource={RelativeSource Mode=Self}}" />
                <TextBox
                    ui:TextBoxExtensions.Mask="+\375 (99) 999 9999"
                    Header="Введите номер телефона:"
                    PlaceholderText="+375 (XX) XXX XXXX"
                    Text="{Binding PhoneNumber, Mode=TwoWay}"
                    ToolTipService.ToolTip="{Binding Header, RelativeSource={RelativeSource Mode=Self}}" />
                <TextBox
                    AcceptsReturn="True"
                    Header="Введите дополнительную информацию:"
                    PlaceholderText="Дополнительная информация"
                    Text="{Binding AdditionalInfo, Mode=TwoWay}"
                    ToolTipService.ToolTip="{Binding Header, RelativeSource={RelativeSource Mode=Self}}" />
                <ComboBox
                    HorizontalAlignment="Stretch"
                    DisplayMemberPath="StatusName"
                    Header="Выберите статус:"
                    IsEnabled="False"
                    ItemsSource="{Binding ClientStatuses}"
                    PlaceholderText="Статус клиента"
                    SelectedValue="{Binding StatusId, Mode=TwoWay}"
                    SelectedValuePath="StatusId"
                    ToolTipService.ToolTip="{Binding Header, RelativeSource={RelativeSource Mode=Self}}" />

                <Grid>
                    <Rectangle
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        RadiusX="8"
                        RadiusY="8"
                        Stroke="{StaticResource SurfaceStrokeColorDefaultBrush}"
                        StrokeThickness="2">
                        <Rectangle.StrokeDashArray>
                            <DoubleCollection>
                                <x:Double>4</x:Double>
                                <x:Double>2</x:Double>
                            </DoubleCollection>
                        </Rectangle.StrokeDashArray>
                    </Rectangle>
                    <Grid Margin="20" VerticalAlignment="Center">
                        <TextBox
                            IsEnabled="False"
                            PlaceholderText="Номер карты СКУД"
                            Text="{Binding AccessCardNumber, Mode=TwoWay}" />

                        <customControls:CopyButton
                            Margin="0,0,1,0"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            CornerRadius="{StaticResource ControlCornerRadius}"
                            Opacity="1">
                            <customControls:CopyButton.Content>
                                <FontIcon Glyph="&#xE8C8;" />
                            </customControls:CopyButton.Content>
                        </customControls:CopyButton>
                    </Grid>
                </Grid>

                <TextBlock
                    Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                    Text="{Binding ErrorMessage}"
                    Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}" />

                <Button
                    HorizontalAlignment="Right"
                    Command="{Binding CreateClientCommand}"
                    Content="Создать"
                    Style="{StaticResource AccentButtonStyle}" />

                <Button
                    Margin="0,8,0,0"
                    Command="{x:Bind ViewModel.GenerateFakeDataCommand}"
                    Content="Сгенерировать тестовые данные"
                    Style="{StaticResource DefaultButtonStyle}" />
            </StackPanel>
        </Grid>

        <Grid
            x:Name="DataPanel"
            Grid.Row="0"
            Grid.Column="1"
            HorizontalAlignment="Stretch"
            ColumnSpacing="16"
            RowSpacing="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>
                <StackPanel
                    Grid.Row="0"
                    Orientation="Horizontal"
                    Spacing="8">
                    <TextBlock
                        VerticalAlignment="Bottom"
                        FontSize="24"
                        FontWeight="Bold"
                        Text="Список клиентов" />
                    <Button
                        Padding="{StaticResource IconInfoBadgeIconMargin}"
                        VerticalAlignment="Bottom"
                        Background="Transparent"
                        BorderThickness="0">
                        <Button.Content>
                            <Grid VerticalAlignment="Center">
                                <FontIcon
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                    Glyph="&#xF13F;" />
                                <FontIcon
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                    Glyph="&#xF138;" />
                            </Grid>
                        </Button.Content>
                        <Button.Flyout>
                            <Flyout>
                                <TextBlock Text="Ваш текст для Flyout" />
                            </Flyout>
                        </Button.Flyout>
                    </Button>
                </StackPanel>
                <StackPanel
                    Grid.Column="1"
                    HorizontalAlignment="Right"
                    Orientation="Horizontal"
                    Spacing="5">
                    <customControls:ButtonRadio
                        GroupName="ButtonRadio"
                        IsChecked="{x:Bind ViewModel.IsGridViewSelected, Mode=TwoWay, Converter={StaticResource BooleanNegationConverter}}"
                        ToolTipService.ToolTip="Список">
                        <FontIcon Glyph="&#xEA37;" />
                    </customControls:ButtonRadio>
                    <customControls:ButtonRadio
                        GroupName="ButtonRadio"
                        IsChecked="{x:Bind ViewModel.IsGridViewSelected, Mode=TwoWay}"
                        ToolTipService.ToolTip="Сетка">
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xF0E2;" />
                    </customControls:ButtonRadio>
                </StackPanel>
            </Grid>

            <ListView
                x:Name="ListView"
                Grid.Row="1"
                ItemsSource="{x:Bind ViewModel.Source, Mode=TwoWay}"
                SelectionMode="Extended"
                Visibility="{Binding IsGridViewSelected, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:Client">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Grid
                                x:Name="Ellipse"
                                Grid.RowSpan="2"
                                Width="32"
                                Height="32"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                CornerRadius="100"
                                Style="{Binding StatusId, Converter={StaticResource StatusColorConverter}, ConverterParameter=Background}">
                                <FontIcon
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Glyph="&#xE716; "
                                    Style="{Binding StatusId, Converter={StaticResource StatusColorConverter}}" />
                            </Grid>

                            <StackPanel
                                Grid.Row="0"
                                Grid.Column="1"
                                Margin="12,6,0,0">
                                <ToolTipService.ToolTip>
                                    <Binding Converter="{StaticResource TooltipConverter}" />
                                </ToolTipService.ToolTip>
                                <TextBlock Style="{ThemeResource BaseTextBlockStyle}">
                                    <TextBlock.Text>
                                        <Binding>
                                            <Binding.Converter>
                                                <helpers:FullNameInitialsConverters />
                                            </Binding.Converter>
                                        </Binding>
                                    </TextBlock.Text>
                                </TextBlock>
                                <TextBlock Style="{ThemeResource BodyTextBlockStyle}" Text="{x:Bind PhoneNumber}" />
                                <TextBlock Style="{ThemeResource BodyTextBlockStyle}" Text="{Binding Status.StatusName}" />
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <controls:AdaptiveGridView
                x:Name="AdaptiveGrid"
                Grid.Row="1"
                HorizontalAlignment="Stretch"
                ContainerContentChanging="MyAdaptiveGridView_ContainerContentChanging"
                DesiredWidth="200"
                IsItemClickEnabled="True"
                ItemContainerStyle="{StaticResource AdaptiveGridViewItemContainerStyle}"
                ItemHeight="150"
                ItemTemplate="{StaticResource ImageTemplate}"
                ItemsSource="{x:Bind ViewModel.Source, Mode=OneWay}"
                SelectionMode="Extended"
                Visibility="{Binding IsGridViewSelected, Converter={StaticResource BooleanToVisibilityConverter}}" />

            <pagination:PaginationControl
                x:Name="PaginationControl"
                Grid.Row="2"
                Margin="16"
                HorizontalAlignment="Center"
                ItemsSource="{x:Bind ViewModel.Source}"
                PageChanged="OnPageChanged"
                PageSize="16"
                TargetControl="{x:Bind ViewModel.ActiveView}"
                TotalItems="{x:Bind ViewModel.TotalItems, Mode=OneWay}" />

            <ProgressRing
                Grid.Row="1"
                Width="50"
                Height="50"
                IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
        </Grid>

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="WindowSizeStates">
                <VisualState x:Name="WideState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1024" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="DataPanel.Grid.Row" Value="0" />
                        <Setter Target="DataPanel.Grid.Column" Value="1" />
                        <Setter Target="DynamicColumn1.Width" Value="auto" />
                        <Setter Target="DynamicColumn2.Width" Value="*" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState x:Name="NarrowState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="DataPanel.Grid.Row" Value="1" />
                        <Setter Target="DataPanel.Grid.Column" Value="0" />
                        <Setter Target="DynamicColumn1.Width" Value="*" />
                        <Setter Target="DynamicColumn2.Width" Value="auto" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>

</Page>